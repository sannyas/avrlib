#include <stdio.h>
#include <usart.h>
#include <util/delay.h>
#include "../enc28j60.h"

uint8_t arp_send[] = {
	0xff,0xff,0xff,0xff,0xff,0xff,
	//0xc0,0xf8,0xda,0x79,0xb3,0x48,
	0x22,0x22,0x22,0x22,0x22,0x22,
	0x08,0x06,
	0x00,0x01,
	0x08,0x00,
	0x06,0x04,
	0x00,0x01,
	0x22,0x22,0x22,0x22,0x22,0x22,
	0xc0,0xa8,0x01,200,
	0x00,0x00,0x00,0x00,0x00,0x00,
	0xc0,0xa8,0x01,250
};

uint8_t icmp_send[] = {
	//ethernet header
	0xc0,0xf8,0xda,0x79,0xb3,0x48,
	0x22,0x22,0x22,0x22,0x22,0x22,
	0x08,0x00,

	// ip header
	0x45,0x00,0x00,0x54,
	0x00,0x00,0x40,0x00,
	0x40,0x01,0xb6,0x23,
	192,168,1,200,
	192,168,1,109,

	// icmp
	0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,
	/*
	0x00,0xe4,0xd1,0x0e,0x00,
	0x00,0x00,0x00,0x00,0x10,
	0x11,0x12,0x13,0x14,0x15,
	0x16,0x17,0x18,0x19,0x1a,
	0x1b,0x1c,0x1d,0x1e,0x1f,
	0x20,0x21,0x22,0x23,0x24,
	0x25,0x26,0x27,0x28,0x29,
	0x2a,0x2b,0x2c,0x2d,0x2e,
	0x2f,0x30,0x31,0x32,0x33,
	0x34,0x35,0x36,0x37 
	*/
};

uint8_t pack_recv[260];

uint8_t mac_addr[] = {
	0x22,0x22,0x22,0x22,0x22,0x22
};


uint8_t func_call_chain_cnt = 0;

int main( void ){
	uint8_t  idx;
	uint8_t temp_8;
	uint16_t temp_16;
	

	usart_init( );
	stdout = &usart_file;
	printf( "main start\n" );

	enc28j60_init( mac_addr );
	enc28j60_writePhy( 0x14,0b0000010001110000 );
	while( 1 ){
		enc28j60_transmitPacket( icmp_send, 42,0 );
		_delay_ms( 1000 );
		enc28j60_transmitPacket( arp_send, 42,0 );
		_delay_ms( 1000 );
	}

	printf( "main end\n" );
	while( 1 );
	return 0;
}
